jQuery(document).ready(function(d){var a=d(".mainnav"),h=d("#deliverynav"),j=d(".tab"),i=d("#tab-delivery").find(".subtab"),e=d("#mailster_nonce").val(),b=d("#reserved-tags").data("tags");d("a.external").on("click",function(){if(this.href){window.open(this.href)}return false});d("form#mailster-settings-form").on("submit",function(){return false});if(d("#settingsloaded").length){d(".submit-form").prop("disabled",false);d("form#mailster-settings-form").off("submit")}else{if(console){console.log("error loading settings page")}}h.on("click","a.nav-tab",function(){h.find("a").removeClass("nav-tab-active");i.hide();var l=d(this).addClass("nav-tab-active").attr("href");d("#deliverymethod").val(l.substr(1));d("#subtab-"+l.substr(1)).show();d("input.mailster_sendtest").val(mailsterL10n.save_to_test).prop("disabled",true);return false});a.on("click","a",function(){a.find("li").removeClass("active");j.hide();var l=d(this).parent().addClass("active").find("a").attr("href");d("#tab-"+l.substr(1)).show();location.hash=l;d("form#mailster-settings-form").attr("action","options.php"+l);return false});d(".click-to-select").on("click",function(m){if(document.selection){var l=document.body.createTextRange();l.moveToElementText(this);l.select()}else{if(window.getSelection){var l=document.createRange();l.selectNode(this);window.getSelection().addRange(l)}}});d("#mailster-settings-form").on("click",'a[href^="#"]',function(){a.find('a[href="'+d(this).attr("href")+'"]').trigger("click")});(location.hash&&a.find('a[href="'+location.hash+'"]').length)?a.find('a[href="'+location.hash+'"]').trigger("click"):a.find("a").eq(0).trigger("click");d(".system_mail").on("change",function(){d(".system_mail_template").prop("disabled",d(this).val()==0)});d("#load_location_db").on("click",function(){var m=d(this),l=d(".geo-ajax-loading").css({visibility:"visible"});d("button").prop("disabled",true);f("load_geo_data",function(n){d("button").prop("disabled",false);l.css({visibility:"hidden"});m.prop("disabled",false).html(n.buttontext);if(n.update){d("#location_last_update").html(n.update)}var o=d('<div class="'+((!n.success)?"error":"updated")+'"><p>'+n.msg+"</p></div>").hide().prependTo(m.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){o.remove()})},function(n,q,o){d("button").prop("disabled",false);l.css({visibility:"hidden"});m.prop("disabled",false);var p=d('<div class="error"><p>'+q+" "+n.status+": "+o+"</p></div>").hide().prependTo(m.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){p.remove()})});return false});d(".webversion-bar-checkbox").on("change",function(){(d(this).is(":checked"))?d("#webversion-bar-options").slideDown(200):d("#webversion-bar-options").slideUp(200)});d("#social-services").on("change",".social-service-dropdown",function(){var n=d(this),m=n.find(":selected"),l=m.data("url");n.next(".social-service-url-field").html('<label><span class="description">'+l.replace("%s",'<input type="text" name="mailster_options[services]['+n.val()+']" value="" class="regular-text">')+"</span></label>").find("input").focus()}).on("click",".social-service-remove",function(){d(this).parent().remove();return false});d(".social-service-add").on("click",function(){d("#social-services").find("li").eq(0).clone().appendTo("#social-services").find("select").val(0).parent().find(".social-service-url-field").empty()});d(".has-archive-check").on("change",function(){(d(this).is(":checked"))?d(".archive-slug").slideDown(200):d(".archive-slug").slideUp(200)});d(".edit-slug").on("click",function(){d(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()});d(".users-register").on("change",function(){(d(this).is(":checked"))?d("#"+d(this).data("section")).slideDown(200):d("#"+d(this).data("section")).slideUp(200)});d("#mailster_spf").on("change",function(){(d(this).is(":checked"))?d(".spf-info").slideDown(200):d(".spf-info").slideUp(200)});d("#mailster_dkim").on("change",function(){(d(this).is(":checked"))?d(".dkim-info").slideDown(200):d(".dkim-info").slideUp(200)});d(".dkim-enter-keys").on("click",function(){d(".dkim-keys").slideDown();return false});d("#bounce_active").on("change",function(){(d(this).is(":checked"))?d("#bounce-options").slideDown(200):d("#bounce-options").slideUp(200)});d("#mailster_generate_dkim_keys").on("click",function(){return(d("#dkim_keys_active").length&&confirm(mailsterL10n.create_new_keys));return false});d("input.smtp.secure").on("change",function(){d("#mailster_smtp_port").val(d(this).data("port"))});d("#capabilities-table").on("mouseenter","label",function(){d("#current-cap").stop().html(d(this).attr("title")).css("opacity",1).show()}).on("mouseleave","tbody",function(){d("#current-cap").fadeOut()}).on("change","input.selectall",function(){var l=d(this);d("input.cap-check-"+l.val()).prop("checked",l.prop("checked"))});d(".mailster_sendtest").on("click",function(){var o=d(this),n=o.closest(".mailster-testmail"),m=n.find(".test-ajax-loading").css({visibility:"visible"}),p=n.find("input.mailster-testmail-email").val(),l=d("form#mailster-settings-form").serialize();o.prop("disabled",true);f("send_test",{test:true,formdata:l,basic:true,to:p},function(q){if(q.log&&console){q.success?console.log(q.log):console.error(q.log)}m.css({visibility:"hidden"});o.prop("disabled",false);var r=d('<div class="'+((!q.success)?"error":"updated")+'"><p>'+q.msg+"</p></div>").hide().prependTo(o.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){r.remove()})},function(q,t,r){m.css({visibility:"hidden"});o.prop("disabled",false);var s=d('<div class="error"><p>'+t+" "+q.status+": "+r+"</p></div>").hide().prependTo(o.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){s.remove()})})});d(".mailster_bouncetest").on("click",function(){var o=d(this),m=d(".bounce-ajax-loading").css({visibility:"visible"}),n=d(".bouncetest_status").empty().show(),l=d("form#mailster-settings-form").serialize();o.prop("disabled",true);f("bounce_test",{formdata:l},function(p){k(p.identifier,1,l,function(){o.prop("disabled",false)})},function(p,r,q){m.css({visibility:"hidden"});o.prop("disabled",false);n.html(r+" "+p.status+": "+q)})});d("input.cron_radio").on("change",function(){d(".cron_opts").hide();d("."+d(this).val()).show()});d(".switch-cron-url").on("click",function(){d(".cron_opts").toggleClass("alternative-cron");return false});d("#mailster_add_tag").on("click",function(){var l=d('<div class="tag"><code>{<input type="text" class="tag-key">}</code> &#10152; <input type="text" class="regular-text tag-value"> <a class="tag-remove">&#10005;</a></div>').insertBefore(d(this));l.find(".tag-key").focus()});d(".tags").on("change",".tag-key",function(){var n=d(this),l=n.parent().parent(),m=c(n.val());if(!m){n.parent().parent().remove()}n.val(m);l.find(".tag-value").attr("name","mailster_options[custom_tags]["+m+"]")}).on("click",".tag-remove",function(){d(this).parent().remove();return false});d("#mailster_add_field").on("click",function(){var l=d('<div class="customfield"><a class="customfield-move-up" title="'+mailsterL10n.move_up+'">&#9650;</a><a class="customfield-move-down" title="'+mailsterL10n.move_down+'">&#9660;</a><div><span class="label">'+mailsterL10n.fieldname+':</span><label><input type="text" class="regular-text customfield-name"></label></div><div><span class="label">'+mailsterL10n.tag+':</span><span><code>{</code><input type="text" class="customfield-key code"><code>}</code></span></div><div><span class="label">'+mailsterL10n.type+':</span><select class="customfield-type"><option value="textfield">'+mailsterL10n.textfield+'</option><option value="textarea">'+mailsterL10n.textarea+'</option><option value="dropdown">'+mailsterL10n.dropdown+'</option><option value="radio">'+mailsterL10n.radio+'</option><option value="checkbox">'+mailsterL10n.checkbox+'</option><option value="date">'+mailsterL10n.datefield+'</option></select></div><ul class="customfield-additional customfield-dropdown customfield-radio"><li><ul class="customfield-values"><li><span>&nbsp;</span> <span class="customfield-value-box"><input type="text" class="regular-text customfield-value" value=""> <label><input type="radio" value="" title="'+mailsterL10n.default_selected+'" class="customfield-default" disabled> '+mailsterL10n.default_field+'</label></span></li></ul><span>&nbsp;</span> <a class="customfield-value-add">'+mailsterL10n.add_field+'</a></li></ul><div class="customfield-additional customfield-checkbox"><span>&nbsp;</span><label><input type="checkbox" value="1" title="'+mailsterL10n.default_field+'" class="customfield-default" disabled> '+mailsterL10n.default_checked+'</label></div><a class="customfield-remove">remove field</a><br></div>').appendTo(d(".customfields").eq(0));l.find(".customfield-name").focus()});d("#sync_list_check").on("change",function(){d("#sync_list").slideToggle(200);d(".sync-button").prop("disabled",true)});d("#sync_list").on("click","#add_sync_item",function(){var l=d(".mailster_syncitem");l.eq(0).clone().insertAfter(l.last()).removeAttr("title").find("select").each(function(){d(this).attr("name",d(this).attr("name").replace("[synclist][0]","[synclist]["+l.length+"]"))});d(".sync-button").prop("disabled",true)}).on("click",".remove-sync-item",function(){d(this).parent().remove();d(".sync-button").prop("disabled",true)}).on("change","select",function(){d(".sync-button").prop("disabled",true)}).on("click","#sync_subscribers_wp",function(){if(event.target==this&&!confirm(mailsterL10n.sync_subscriber)){return false}var m=d(this),l=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);f("sync_all_subscriber",{offset:m.data("offset")},function(n){d(".sync-button").prop("disabled",false);if(n.success&&n.count){m.data("offset",n.offset).trigger("click")}else{l.css({visibility:"hidden"});m.data("offset",0)}},function(n,p,o){l.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false}).on("click","#sync_wp_subscribers",function(){if(event.target==this&&!confirm(mailsterL10n.sync_wp_user)){return false}var m=d(this),l=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);f("sync_all_wp_user",{offset:m.data("offset")},function(n){d(".sync-button").prop("disabled",false);if(n.success&&n.count){m.data("offset",n.offset).trigger("click")}else{l.css({visibility:"hidden"});m.data("offset",0)}},function(n,p,o){l.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false});d(".customfields").on("change",".customfield-name",function(){var m=d(this),l=m.parent().parent().parent().find(".customfield-key");if(!l.val()){l.val(m.val()).trigger("change")}}).on("change",".customfield-key",function(){var n=d(this),l=n.parent().parent().parent(),m=c(n.val());if(!m){l.remove()}n.val(m);l.find(".customfield-name").attr("name","mailster_options[custom_field]["+m+"][name]");l.find(".customfield-type").attr("name","mailster_options[custom_field]["+m+"][type]");l.find(".customfield-value").attr("name","mailster_options[custom_field]["+m+"][values][]");l.find(".customfield-default").attr("name","mailster_options[custom_field]["+m+"][default]")}).on("click",".customfield-remove",function(){d(this).parent().remove()}).on("click",".customfield-move-up",function(){var l=d(this).parent();l.insertBefore(l.prev())}).on("click",".customfield-move-down",function(){var l=d(this).parent();l.insertAfter(l.next())}).on("change",".customfield-type",function(){var l=d(this).val();d(this).parent().parent().find(".customfield-additional").slideUp(200).find("input").prop("disabled",true);if(l!="textfield"){d(this).parent().parent().find(".customfield-"+l).stop().slideDown(200).find("input").prop("disabled",false)}}).on("change",".customfield-value",function(){d(this).next().find("input").val(d(this).val())}).on("click","a.customfield-value-remove",function(){d(this).parent().parent().remove()}).on("click","a.customfield-value-add",function(){var l=d(this).parent().find("li").eq(0).clone();l.appendTo(d(this).parent().find("ul")).find("input").val("").focus().select()});d("#mailster_import_data").on("click",function(){if(!confirm(mailsterL10n.import_data)){return false}});d("#mailster_reset_data").on("click",function(){if(!confirm(mailsterL10n.reset_data)){return false}});function k(o,p,m,r){var q=d(this),l=d(".bounce-ajax-loading").css({visibility:"visible"}),n=d(".bouncetest_status");f("bounce_test_check",{identifier:o,passes:p,formdata:m},function(s){n.html(s.msg);if(s.complete){l.css({visibility:"hidden"});r&&r()}else{setTimeout(function(){k(o,++p,m,r)},1000)}},function(s,u,t){l.css({visibility:"hidden"});q.prop("disabled",false);n.html(u+" "+s.status+": "+t)})}function c(m){var l=d.trim(m).toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9_-]*/g,"").replace(/^[_]*/,"").replace(/[_]*$/,"");if(d.inArray(l,b)!=-1){alert(g(mailsterL10n.reserved_tag,'"'+l+'"'));l+="-a"}return l}function f(n,m,o,l){if(d.isFunction(m)){if(d.isFunction(o)){l=o}o=m;m={}}d.ajax({type:"POST",url:ajaxurl,data:d.extend({action:"mailster_"+n,_wpnonce:e},m),success:function(q,r,p){o&&o.call(this,q,r,p)},error:function(p,r,q){if(r=="error"&&!q){return}if(console){console.error(d.trim(p.responseText))}l&&l.call(this,p,r,q)},dataType:"JSON"})}function g(){var l=Array.prototype.slice.call(arguments),p=l.shift(),o=l.length,n;for(var m=0;m<o;m++){n=new RegExp("%("+(m+1)+"\\$)?(s|d|f)");p=p.replace(n,l[m])}return p}});